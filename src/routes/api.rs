use actix_web::{HttpResponse, web};

use crate::handlers;
use crate::middleware::auth::AuthMiddleware;

pub fn scoped_config(cfg: &mut web::ServiceConfig) {
    cfg.service(
        web::scope("/auth")
            .service(web::resource("/register").route(web::post().to(handlers::auth::register)))
            .service(web::resource("/login").route(web::post().to(handlers::auth::login))),
    )
    .service(
        web::scope("/users").service(
            web::resource("")
                .route(web::get().to(handlers::users::index))
                .route(web::head().to(HttpResponse::MethodNotAllowed)),
        ),
    )
    .service(
        web::scope("/contributions")
            .service(
                web::resource("")
                    .route(
                        web::post()
                            .to(handlers::contributions::create)
                            .wrap(AuthMiddleware),
                    )
                    .route(web::get().to(handlers::contributions::all))
                    .route(web::head().to(HttpResponse::MethodNotAllowed)),
            )
            .service(
                web::resource("/user")
                    .route(
                        web::get()
                            .to(handlers::contributions::get_user_contributions)
                            .wrap(AuthMiddleware),
                    )
                    .route(web::head().to(HttpResponse::MethodNotAllowed)),
            )
            .service(
                web::resource("/{id}")
                    .route(web::get().to(handlers::contributions::get_contribution))
                    .route(
                        web::delete()
                            .to(handlers::contributions::delete)
                            .wrap(AuthMiddleware),
                    )
                    .route(
                        web::put()
                            .to(handlers::contributions::update)
                            .wrap(AuthMiddleware),
                    )
                    .route(web::head().to(HttpResponse::MethodNotAllowed)),
            ),
    )
    .service(
        web::scope("/payments")
            .wrap(AuthMiddleware)
            .service(
                web::resource("")
                    .route(web::get().to(handlers::payments::all))
                    .route(web::post().to(handlers::payments::create))
                    .route(web::head().to(HttpResponse::MethodNotAllowed)),
            )
            .service(
                web::resource("/{id}")
                    .route(web::get().to(handlers::payments::get_payment))
                    .route(web::delete().to(handlers::payments::delete))
                    .route(web::put().to(handlers::payments::update))
                    .route(web::head().to(HttpResponse::MethodNotAllowed)),
            )
            .service(
                web::resource("/user/{user_id}")
                    .route(web::get().to(handlers::payments::get_user_payments))
                    .route(web::head().to(HttpResponse::MethodNotAllowed)),
            ),
    )
    .service(
        web::scope("/announcements")
            .wrap(AuthMiddleware)
            .service(
                web::resource("")
                    .route(web::get().to(handlers::announcements::all))
                    .route(web::post().to(handlers::announcements::create))
                    .route(web::head().to(HttpResponse::MethodNotAllowed)),
            )
            .service(
                web::resource("/{id}")
                    .route(web::get().to(handlers::announcements::get_announcement))
                    .route(web::delete().to(handlers::announcements::delete))
                    .route(web::put().to(handlers::announcements::update))
                    .route(web::head().to(HttpResponse::MethodNotAllowed)),
            ),
    );
}
